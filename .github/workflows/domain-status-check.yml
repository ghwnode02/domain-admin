name: Domain Status Check

# å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ 9:30 æ‰§è¡Œï¼ˆå·²ç¦ç”¨è‡ªåŠ¨æ‰§è¡Œï¼Œå¯æ‰‹åŠ¨è§¦å‘ï¼‰
on:
  # schedule:                        # å–æ¶ˆæ³¨é‡Šä»¥å¯ç”¨è‡ªåŠ¨æ‰§è¡Œ
  #   - cron: '30 1 * * *'           # UTC 1:30 = åŒ—äº¬æ—¶é—´ 9:30
  workflow_dispatch:                  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  check-status:
    runs-on: ubuntu-latest
    steps:
      - name: Validate Configuration
        run: |
          if [ -z "${{ secrets.PAGES_URL }}" ]; then
            echo "âŒ é”™è¯¯ï¼šPAGES_URL Secret æœªé…ç½®ï¼"
            echo "è¯·åœ¨ä»“åº“è®¾ç½®ä¸­æ·»åŠ  PAGES_URL Secret"
            echo "è·¯å¾„ï¼šSettings > Secrets and variables > Actions > New repository secret"
            exit 1
          fi
          echo "âœ… PAGES_URL å·²é…ç½®"
          
      - name: Check Domain Status
        run: |
          echo "ğŸš€ è°ƒç”¨ API: ${{ secrets.PAGES_URL }}/api/cron/check-status"
          
          response=$(curl -s -w "\n%{http_code}" -X GET "${{ secrets.PAGES_URL }}/api/cron/check-status")
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo "ğŸ“Š HTTP Status: $http_code"
          echo "ğŸ“„ Response Body: $body"
          
          if [ "$http_code" -ne 200 ]; then
            echo "âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥"
            exit 1
          else
            echo "âœ… çŠ¶æ€æ£€æŸ¥å®Œæˆ"
          fi
